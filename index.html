<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="iso-8859-1">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
    <meta name="author" content="Valentin Schwind">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>
    
    <link rel="stylesheet" href="css/style.css" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta property="og:site_name" content="Informed Consent Generator"> 
    <title>Informed Consent Generator</title>   
</head>
 <body class="transparent">
    
    <div id="mainFrame" class="vertical-center">
        <a id="downloadAnchorElem" style="display:none"></a>
        <div id="demographicsPage" class="whiteBox container rounded">
            <form id="demographicsForm" class="form-horizontal" action="javascript:generate(this);">
                <div id="input">
                    <div class="row">
                        <div class="col mt-4 mb-2 ">
                            <a id="hostUrl" href=""><img id="hostLogo" class="float-right  mr-3" width="140px" alt="Media Informatics Groups"></a>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <h3 id="demographicsTitle" class="display-6">Informed Consent Generator</h3>
                        </div>
                    </div>
                    <hr />
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="institutionText">Your Institution</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="institution" onchange="onChange(event)" required></select></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="researchText">Kind of research</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="type" onchange="onChange(event)" required></select></div>
                    </div>
                    
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="topicText">Title</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="title" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="compensationText">Compensation</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="compensation" onchange="onChange(event)" required></select></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="monetaryCompensationText">Monetary Compensation </span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="monetaryCompensation" onchange="onChange(event)" required></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="recordingsText">Recorded Data</span></div>
                        <div class="col ml-4">
                            <div class="row">
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordDemographics" id="recordDemographics" onchange="onChange(event)" checked><label class="form-check-label" for="recordDemographics">Demographics</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordAudio" id="recordAudio" onchange="onChange(event)"><label class="form-check-label" for="recordAudio">Audio</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordPhotos" id="recordPhotos" onchange="onChange(event)"><label class="form-check-label" for="recordPhotos">Photos</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordVideos" id="recordVideos" onchange="onChange(event)"><label class="form-check-label" for="recordVideos">Videos</label></div> 
                            </div>  
                            <div class="row">
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordMotion" id="recordMotion" onchange="onChange(event)"><label class="form-check-label" for="recordMotion">Motion Tracking</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordPhysiological" id="recordPhysiological" onchange="onChange(event)"><label class="form-check-label" for="recordPhysiological">Physio. Sensing</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordEyetracking" id="recordEyetracking" onchange="onChange(event)"><label class="form-check-label" for="recordEyetracking">Eye/Head Tracking</label></div>
                                <div class="col"><input type="checkbox" class="form-check-input" name="recordScreenrecoding" id="recordScreenrecoding" onchange="onChange(event)"><label class="form-check-label" for="recordScreenrecoding">Screen Recording</label></div>
                            </div>                      
                        </div>                      
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="anonymizationText">Do you make the raw data public?</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><select class="form-control" name="anonymization" onchange="onChange(event)" required></select></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="durationText">Estimated Study Duration</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="duration" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="durationText">Estimated Number of Participants</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="participants" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="purposeText">Purpose (one sentence)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="purpose" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="goalText">Goal (one sentence)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="goal" onchange="onChange(event)" required></input></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="procedureText">Procedure (in 4-6 steps)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><textarea rows="4" class="form-control" name="procedure" onchange="onChange(event)" required></textarea></div>
                    </div> 
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="thePIname">First Researchers' Name (The PI)</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" name="thePIname" onchange="onChange(event)" required></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="thePIemail">First Researchers' E-Mail</span><span class="text-danger">*</span><br /></div>
                        <div class="col-8"><input class="form-control" type="email" name="thePIemail" onchange="onChange(event)" required></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="PIText">Head of the Department (if not = PI)</span></div>
                        <div class="col-8"><input class="form-control" name="departmentHead" onchange="onChange(event)"></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="secondResearcherName">Second Researchers's Name</span></div>
                        <div class="col-8"><input class="form-control" name="secondResearcherName" onchange="onChange(event)"></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="secondResearcherEmail">Second  Researchers's E-Mail</span></div>
                        <div class="col-8"><input class="form-control" type="email" name="secondResearcherEmail" onchange="onChange(event)"></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="thirdResearcherName">Thrid Researchers's Name (e.g., the student)</span></div>
                        <div class="col-8"><input class="form-control" name="thirdResearcherName" onchange="onChange(event)"></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="thirdResearcherEmail">Thrid Researchers's E-Mail</span></div>
                        <div class="col-8"><input class="form-control" type="email" name="thirdResearcherEmail" onchange="onChange(event)"></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="funding">Funding</span></div>
                        <div class="col-8"><input class="form-control" name="funding" onchange="onChange(event)"></input></div>
                    </div>
                    <div class="row mt-3 ">
                        <div class="col-4"><span id="ethicalComitteeText">Ethical Comittee</span></div>
                        <div class="col-8"><input class="form-control" name="ethicalComittee" onchange="onChange(event)"></input></div>
                    </div>
                    </div>
                    <div class="row mt-3 mb-3 itemRow" id="fieldsrequired">
                        <div class="col" >
                            <span class="text-danger">* fields required</span> <br />
                        </div>
                    </div>
                    <hr class="uiEdit">
                    <div class="row mt-3 itemRow uiEdit">
                        <div class="col-8">
                            <a id="btnExample" class="btn btn-secondary btn-md float-left mr-3 " >Example</a> 
                            <a class="btn btn-secondary btn-md float-left mr-3 btnSave" >Save (*.json)</a>
                        </div>
                        <div class="d-grid gap-2 col-4 mx-auto">
                            <button id="btnGenerate" class="btn btn-primary btn-md float-right" type="Submit" value="">Generate</button>
                        </div>
                    </div>
                    <div class="row mt-3 itemRow uiEdit">
                        <div class="col-2">
                            <label for="loadFile" class="form-label">Load (*.json)</label>
                        </div>
                        <div class="col-6">
                            <input class="form-control form-control-sm" id="loadFile" type="file">
                        </div>
                        <div class="col-4">
                        </div>
                    </div>

                    <div class="row mt-2 itemRow uiView">
                        <div class="col" >
                            <button id="btnBack" class="btn btn-primary btn-md float-left btnBack" >Back</button> 
                            <button class="btn btn-secondary btn-md float-left mr-3 btnSave" >Save (*.json)</button>
                            <button id="btnPrint" class="btn btn-primary btn-md float-right" value="">Print</button>
                        </div>
                    </div>
                <div id="results"></div>
                <div class="row mt-2 mb-2 itemRow" id="githublink">
                    <div class="row mt-2 itemRow uiView">
                        <div class="col" >
                            <button id="btnBack" class="btn btn-primary btn-md float-left btnBack" >Back</button>
                        </div>
                    </div>
                    <div class="col" > 
                        <a href="https://github.com/interactionlab/informed-consent-generator/">Source Code on github</a>
                    </div>
                </div>
            </form>
        </div>

        
    </div>

    
    <script>

        function onChange(event){
            data = collectData();
        }

        function capitalize(s)
        {
            return s && s[0].toUpperCase() + s.slice(1);
        }

        function capital_letter(str) {
            str = str.split(" ");
            for (var i = 0, x = str.length; i < x; i++) {
                str[i] = str[i][0].toUpperCase() + str[i].substr(1);
            }
            return str.join(" ");
        }

        function downloadObjectAsJson(data, fileName){
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
            var downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", fileName);
            document.body.appendChild(downloadAnchorNode); // required for firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function getCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0;i < ca.length;i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
            }
            return null;
        }

        var inputKeys = ["title", "duration", "purpose", "goal", "departmentHead", "thePIname", "thePIemail", "participants", "monetaryCompensation", "secondResearcherName", "secondResearcherEmail", "thirdResearcherName", "thirdResearcherEmail", "ethicalComittee", "funding"];
        var inputRecord = ["demographics", "audio", "photos", "videos", "motion", "physiological", "eyetracking", "screenrecoding"]

        var settings = {};
        var data = {};
        $(document).ready(function() {
            
            fillSelect();


            $("#hostUrl").attr("href", settings["hostUrl"]);
            $("#hostLogo").attr("src", "img/" + settings["hostLogo"]);

            $(".btnSave").click(function() {
                data = collectData();
                downloadObjectAsJson(data, "exportInformedConsent.json");
            });

            function loadFile(event) {
                var reader = new FileReader();

                reader.onload = function(event) {
                    var jsonObj = JSON.parse(event.target.result);
                    data = jsonObj;
                    fillData(data);
                };

                reader.readAsText(event.target.files[0]);
            };

            document.getElementById('loadFile').addEventListener('change', loadFile);

            $("#btnExample").click(function() {
                let example = {
                    "type":"field study",
                    "title":"Fitts' Task in Virtual Reality using Avatar Hands",
                    "duration":"60 minutes",
                    "participants":"36",
                    "anonymization":"anonymized",
                    "purpose":"The purpose of this research is to study human performance in a pointing task with different avatar hands in virtual reality.",
                    "goal":"The goal of this research is to understand how visual signals of the own body are incorporated into the own body scheme.",
                    "procedure":"1. You will get a virtual reality headset and will be introduced with virtual hands in the environment\n2. You will see a virtual questionnaire. Tap on the table with you index finger to fill out the questionnaire. \n3. In multiple rounds, you have to point at virtual circles highlighted in red. \n4. This procedure will repeat multiple times using different hand conditions.",
                    "compensation":"money",
                    "monetaryCompensation":"5 EUR",
                    "institution":"University of Regensburg",
                    "departmentHead":"Prof. Dr. Sven Mayer",
                    "thePIname":"Prof. Dr. Sven Mayer",
                    "thePIemail":"sven.mayer@ifi.lmu.de",
                    "secondResearcherName":"Maxy Musterfrau",
                    "secondResearcherEmail":"maxy.musterfrau@stud.uni-regensburg.de",
                    "thirdResearcherName":"Maxy Musterfrau",
                    "thirdResearcherEmail":"maxy.musterfrau@stud.uni-regensburg.de",
                    "ethicalComittee":"DFG/BMBF/Uni-Regensburg",
                    "funding":"GEVAKUB",
                    "record":{
                        "demographics":true,
                        "audio":false,
                        "photos":true,
                        "videos":true,
                        "motion":true,
                        "physiological":true,
                        "eyetracking":false,
                        "screenrecoding":true,
                    }
                }

                fillData(example);
                data = collectData();
            });

            let cookieData = getCookie("data");
            if (cookieData != null){
                cookieData = JSON.parse(cookieData);
                fillData(cookieData);
            } else {
                //console.log("No Cookie Available");
            }
        });

        function myXOR(a,b) {
          return ( a || b ) && !( a && b );
        }

        function fillSelect(){

            var request = new XMLHttpRequest();
            request.open("GET", "settings.json", false);
            request.send(null);
            settings = JSON.parse(request.responseText);

            $("select[name='institution']").append(new Option(settings["hints"]["select"], ""));
            for (let key in settings["institutions"]) {
                let institution = settings["institutions"][key]
                $("select[name='institution']").append(new Option(institution["name"], institution["name"]));
            }

            $("select[name='type']").append(new Option(settings["hints"]["select"], ""));
            for (let i = 0; i < settings["types"].length; i++) {
                type = settings["types"][i]
                $("select[name='type']").append(new Option(type[0], type[1]));
            }
            
            $("select[name='anonymization']").append(new Option(settings["hints"]["select"], ""));
            for (let i = 0; i < settings["dataAnonymization"].length; i++) {
                anonymization = settings["dataAnonymization"][i]
                $("select[name='anonymization']").append(new Option(anonymization[0], anonymization[1]));
            }

            $("select[name='compensation']").append(new Option(settings["hints"]["select"], ""));
            for (let i = 0; i < settings["compensation"].length; i++) {
                compensation = settings["compensation"][i]
                $("select[name='compensation']").append(new Option(compensation[0], compensation[1]));
            }
            
            var hints = settings["hints"]
            for (let key in hints) {
                if (key == "select"){
                    //None
                }
                else if (key == "procedure"){
                    $("textarea[name='" + key + "'] ").attr("placeholder", hints[key]);
                } else {
                    $("input[name='" + key + "'] ").attr("placeholder", hints[key]);
                }
            }

            $(".uiEdit").show();
            $(".uiView").hide();
            $(".btnBack").click(function(e){
                e.preventDefault();
                $(".uiEdit").show();
                $(".uiView").hide();
                $("#input").show(); 
                $("#fieldsrequired").show();
                $("#btnGenerate").show();
                $("#results").html("");
            });
            
            $("#btnPrint").click(function(e){
                $('.print_special').css({ border : 'none'});
                window.print(); 
                e.preventDefault();
            });
        }
        
        function fillData(data){
            $("textarea[name='procedure']").val(data["procedure"]);
            var record = data["record"];
            for (let key in record) {
                $("input[name='record" + capitalize(key) + "']").prop("checked", record[key]);
            }
            
            inputKeys.forEach((key) => {
                $("input[name='" + key + "']").val(data[key]);
            });

            $("select[name='institution'] option[value='" + data["institution"] + "']").attr("selected", true);
            $("select[name='type'] option[value='" + data["type"] + "']").attr("selected", true);
            $("select[name='anonymization'] option[value='" + data["anonymization"] + "']").attr("selected", true);
            $("select[name='compensation'] option[value='" + data["compensation"] + "']").attr("selected", true);
        }

        function collectData(){
            let data = {};
            inputKeys.forEach((key) => {
                data[key] = $("input[name='" + key + "']").val();
            });

            data["record"] = {};
            inputRecord.forEach((key) => {
                data["record"][key] = $("input[name='record" + capitalize(key) + "']").prop('checked')
            });


            data["procedure"] = $("textarea[name='procedure']").val();
            data["institution"] = $("select[name='institution']").val();
            data["type"] = $("select[name='type']").val();
            data["anonymization"] = $("select[name='anonymization']").val();
            data["compensation"] = $("select[name='compensation']").val();

            document.cookie = "data=" + JSON.stringify(data);

            return data;
        }

        function generate(){
            data = collectData();

            $(".uiView").show();
            $(".uiEdit").hide();
            $("#input").hide();
            $("#fieldsrequired").hide();

            var article = "";
            var str = "";
            
            switch(data["type"]){
                case "online study": article = " an "; break;
                case "user study": article = " a "; break;
                case "field study": article = " a "; break;
                case "interview": article = " an "; break;
            }
            
            str += "<div class='row' id='firstItem'><div class='col mt-4 mb-2 '><img src='img/" + settings["institutions"][data["institution"]]["logo"] + "' class='float-right' width='150px' alt='Logo' /></a></div></div>";
 
            // TITLE
            str += "<div class='pageBreak'><h1>Informed Consent of Participation</h1>";
            var andStudent = "";
            if(data["thirdResearcherName"] != ""){
                andStudent += data["thirdResearcherName"] + " and ";
            }

            if(data["secondResearcherName"] != ""){
                andStudent += data["secondResearcherName"] + " and ";
            }
            
            // INVITATION (SUMMARY OF THE FOLLOWING)
            str += "<p>You are invited to participate in the " + data["type"] + " <b>" + capital_letter(data["title"]) + "</b> initiated and conducted by " + andStudent + data["thePIname"]  + ". The research is supervised";
            if(data["departmentHead"] != ""){
                str += " by " + data["departmentHead"];
            }
            if(data["thePIname"] != ""){
                str += " by " + data["thePIname"];
            }
            if(data["institution"] != ""){
                str += " at the " + data["institution"];
            }
            str += ". ";
            if(data["funding"] != ""){ 
                str += "This study is funded and financed by the research project " + data["funding"] + ". ";
            } 
            
            // BULLET POINT AT THE BEGINNING
            str += "Please note:<ul><li>Your participation is entirely voluntary</li><li>The " + data["type"] + " will last approximately " + data["duration"] + "</li>";
            
            if(data["record"]["demographics"])
                str += "<li>We will record personal demographics (age, gender, etc.)</li>";
            if(data["record"]["photos"])
                str += "<li>We will take photos during the session</li>";
            if(data["record"]["videos"]) 
                str += "<li>We will record videos during the session</li>";
            if(data["record"]["audio"])
                str += "<li>We will record audio during the session</li>";
            if(data["record"]["motion"])
                str += "<li>We will track your body motion during the session</li>";
            if(data["record"]["eyetracking"])
                str += "<li>We will track your eye and head motion during the session</li>";
            if(data["record"]["physiological"])
                str += "<li>We will take physiological measurements of your body</li>";
            if(data["record"]["screenrecoding"])
                str += "<li>We will record the screen and/or activities on your device that are necessary for the study</li>";
            
            if(data["compensation"] == "points" | data["compensation"] == "moneyPoints"){
                str += "<li>You will receive 1 credit point per hour for your study course as compensation</li>";
            }
            
            str += "<li>We may publish our results from this and other sessions in our reports, but all such reports will be confidential and will neither include your name nor cannot be associated with your identity</li></ul>";
            
            str += "<p>If you have any questions or complaints about the whole informed consent process of this research study or your rights as a human research subject, please contact ";
            
            if(data["ethicalComittee"] != ""){
                str += "our ethical comitte office: " + data["ethicalComittee"] + ". ";
            } else if (data["departmentHead"] != "") {
                str += data["thePIname"] + " (E-Mail: " + data["thePIemail"] +") or "+ data["departmentHead"] + ". ";
            
            } else {
                str += data["thePIname"]+ " (E-Mail: " + data["thePIemail"] +"). ";
            
            }
            str += "You should carefully read the settings below. Please take as much time as you need to read the consent form.</p></div>";
            
            var itemCount = 1;
            
            // GOAL AND PURPOSE
            str += "<div class='pageBreak'><h3>" + itemCount + ". Purpose and Goal of this Research</h2>";
            str += "<p>"+data["purpose"]+" "+ data["goal"] + " Your participation will help us achieve this goal. ";
            str += "The results of this research may be presented at scientific or professional meetings or published in scientific proceedings and journals. </p></div>";
            
            itemCount++;
            
            // PARTICIPATION AND COMPENSATION
            str += "<div class='pageBreak'><h3>" + itemCount + ". Participation and Compensation</h3>";
            str += "<p>Your participation in this " + data["type"] + " is completely voluntary. ";
            str += "You will be one of approximately " + data["participants"] + " people being ";
            
            switch(data["type"]){
                case "online study": str += "surveyed "; break;
                case "user study": str += "tested "; break;
                case "field study":  str += "surveyed "; break;
                case "interview":  str += "interviewed "; break;
            }
            str += "for this research. ";
            
            if(data["compensation"] == "none"){
                str += "You will receive no compensation. You may withdraw and discontinue participation at any time without penalty. If you decline to participate or withdraw from the " + data["type"] + ", no one on the campus will be told. ";
            } else {
                if(data["compensation"] == "points" | data["compensation"] == "moneyPoints"){
                    str += "You will receive one credit point per hour required for your study course at the " + data["institution"]  + ". You may withdraw and discontinue participation at any time without justification for withdrawing. You will still receive your extra one credit point that your professor had offered in exchange for your participation. If you decline to participate or withdraw from the " + data["type"] + ", no one on the campus will be told. ";
                } 
                if(data["compensation"] == "money" | data["compensation"] == "moneyPoints"){
                    str += "You will receive " + data["monetaryCompensation"] + " as compensation for your participation. You may withdraw and discontinue participation at any time without penalty or losing the compensation. If you decline to participate or withdraw from the " + data["type"] + ", no one on the campus will be told. ";
                }
            }
            
            str += "You may refuse to answer any questions you do not want to answer. ";
            
            if(data["type"] == "experimental study")    
                str += "The investigator may withdraw you from this research if your physician tells us that continued participation may injure your health. ";
                
            if(data["type"] == "interview")    
                str += "I have the right not to answer questions, and if I feel uncomfortable in any way during the interview session, I have the right to withdraw from the interview. ";
                
            itemCount++;
            // PROCEDURE
            
            str += "</p></div><div class='pageBreak'><h3>" + itemCount + ". Procedure</h3>";
            str += "After confirming your informed consent, you will be guided through the following steps:<div style='padding-left: 10px; padding-top: 0px'>" + data["procedure"].replace(/\n/g, "<br />") + "</div><p>The complete procedure of this " + data["type"] + " will last approximately " + data["duration"] + ".</p>";
            str += "</div>";
            
            itemCount++;
            // RISKS AND BENEFITS
            
            str += "<div class='pageBreak'><h3>" + itemCount + ". Risks and Benefits</h3>";
            str += "<p>There are no risks associated with this " + data["type"] + ". Discomforts or inconveniences will be minor and are not likely to happen. If any discomforts become a problem, you may discontinue your participation. ";
            
            if(data["compensation"] == "none") 
                str += "You will not directly benefit through participation in this "+ $("select[name='type']").val() +". We hope that the settings obtained from your participation may help to bring forward the research in this field. ";
            else    
                str += "Your benefit in participating is your compensation descibed above";
                
            str += "</p></div>";
            
            itemCount++;
            // DATA PROTECTION
            
            str += "<div class='pageBreak'><h3>" + itemCount + ". Data Protection and Confidentiality</h3>";
            str += "<p>";
            
            if(data["record"]["demographics"]) {
                str += "Personal data (age, gender, etc.) will be recorded during participation. ";
            }
            
            if(data["type"] == "online study"){
                str += "The contact details of the study participants can be used to track potential infection chains. ";
            } 
            
            str += "The researcher will not identify you by your real name in any reports using settings obtained from this "+ $("select[name='type']").val() + ", and your confidentiality as a participant in this " + $("select[name='type']").val() + " will remain secure and encrypted. " ;
            
            str += "All data you provide in this " + $("select[name='type']").val() + " will be published anonymized and treated confidentially in compliance with the General Data Protection Regulation (GDPR) of the European Union (EU). ";
                        
            if(data["anonymization"] == "yes")
                str += "Subsequent uses of records and data will be subject to standard data use policies. ";
                        
            if(data["anonymization"] == "anonymized")
                str += "Subsequent uses of records and data will be subject to standard data use policies that protect the participating individuals' anonymity. ";
                
            str += "In all cases, uses of records and data will be subject to the GDPR. ";
            str += "Faculty and administrators from the campus will not have access to raw data or transcripts. This precaution will prevent your individual comments from having any negative repercussions. ";
            
            if(data["type"] == "interview"){
                str += "The interview transcript will be primarily analyzed by ";
                
                if(data["thePIname"] != ""){
                    str += data["thePIname"];
                }
                if(data["secondResearcherName"] != ""){
                    str += " and " + data["secondResearcherName"];
                }
                if(data["thirdResearcherName"] != ""){
                    str += " and " + data["thirdResearcherName"];
                }
                str += ". ";

                str += "Access to the raw interview transcript will be limited to the authors of this research, academic colleagues, and researchers with whom he might collaborate as part of the research process. Any summary interview content, or direct quotations from the interview, that are made available through academic publications or other outlets will be anonymized so that you cannot be identified, and care will be taken to ensure that other settings in the interview that could identify you is not revealed. I have the right not to answer questions, and if I feel uncomfortable in any way during the interview session, I have the right to withdraw from the interview. ";
            }    
            
            if(data["type"] == "online study"){
                str+= "This site uses cookies and other tracking technologies to conduct the research, to improve the user experience, the ability to interact with the system and to provide additional content from third parties. Despite careful control of content, the researchers assume no liability for damages, which directly or indirectly result from the use of this online application. ";
            }
            
            var records ="";
            
            if(data["type"] != "online study"){
                records = "We will record data, ";
                if(data["record"]["photos"]) records += "take photos, ";
                if(data["record"]["videos"]) records += "record videos, ";
                if(data["record"]["audio"]) records += "record audio, ";
                if(data["record"]["motion"]) records += "record your body motion, ";
                if(data["record"]["eyetracking"]) records += "record your eye motion, ";
                if(data["record"]["physiological"]) records += "take physiological measurements, ";
                if(data["record"]["screenrecoding"]) records += "record the screen and/or activities on your device, ";
                records += " and will potentially take notes during the " + data["type"] + ". ";
                str += records;
            }
            
            str += "No one outside this research project can view any recordings unless we have you sign a separate permission form allowing us to use them (see below). ";
            
            if(data["anonymization"] == "no"){
                str += "The records will be destroyed after the end of the research ";
                if(data["funding"] != "")
                    str += "as required by the funding organization ";
                str += "or if you contact the researcher to destroy or delete them immediately. ";
            } else {
                str += "Records that have not been made public will be deleted after the end of the research. The records will be destroyed if you contact the researcher to destroy or delete them immediately. ";
            }
            
            str += "As with any publication or online-related activity, the risk of a breach of confidentiality is always possible. According to the GDPR, the researchers will inform the participant if a breach of confidential data is detected. ";
            
            str += records + "</p></div>";
            
            itemCount++;
            // IDENTIFICATION OF INVESTIGATORS
            
            str += "<div class='pageBreak'><h3>" + itemCount + ". Identification of Investigators</h3>";
            
            var street = "";
            var zip = "";
            var city = "";
            var country = "Germany";
            
            let institution = settings["institutions"][data["institution"]]
            street = institution["street"];
            zip = institution["zip"];
            city = institution["city"];
            
            str += "<p>If you have any questions or concerns about the research, please feel free to contact: </p><div class='row'>";

            var count = 0
            if (data["departmentHead"] != "") {
                count++;
            } 
            if (data["secondResearcherName"] != ""){
                count++;
            }
            if (data["thirdResearcherName"] != ""){
                count++;
            }

            if (count == 1){
                cells = "<div class='col-12'>";
            } else if (count == 2){
                cells = "<div class='col-6'>";
            } else if (count == 3){
                cells = "<div class='col-4'>";
            } else {
                cells = "<div class='col-3'>";
            }
            
            if($("input[name='thirdResearcherName']").val()!=""){
                str += cells + data["thirdResearcherName"] +"<br />" + data["thirdResearcherEmail"] + "</div>";
            }

            if(data["secondResearcherName"] != ""){
                str += cells + data["secondResearcherName"] +"<br />" + data["secondResearcherEmail"] + "</div>";
            }
            
            if(data["thePIname"]!=""){
                str += cells + data["thePIname"] + "<br />Principal Investigator<br />" + street + "<br />" + zip + " " + city + ", " + country + "<br />" + data["thePIemail"] + "</div>";
            }
            
            if(data["departmentHead"] != "" && data["departmentHead"] != data["thePIname"]){
                str += cells+ data["departmentHead"] +"<br />Professor/Head of Department<br />" + street + "<br />" + zip + " " + city + ", " + country + "</div>";
            }
            
            str += "<br /></div></div>";
            
            itemCount++;
            // INFORMED CONSENT
            
            if(data["type"] != "online study"){
                str += "<div class='pageBreak'><h3>" + itemCount + ". Informed Consent and Agreement</h3>";
                str += "<table>";

                str += "<tr><th><img src='img/square.jpg' width='15px'  heighz='15px'/></th><th><p>I understand the explanation provided to me. I have been given a copy of this form. I have had all my questions answered to my satisfaction, and I voluntarily agree to participate in this " + data["type"] +".<p /></th></tr>";
               
                if(data["anonymization"] == "yes"){
                    str += "<tr><th><img src='img/square.jpg'  width='15px'  height='15px'/></th><th><p>I agree that my data records and measurements during the study can be published in context of this research.<p>"
                
                    if(data["type"] != "online study"){
                        str += "<table>"
                        if(data["record"]["photos"]) str += "<tr><th><img src='img/square.jpg' width='15px'  height='15px'/></th><th><p>I additionally agree that photos during this study can be made and published.<p /></th></tr>"
                        if(data["record"]["videos"]) str += "<tr><th><img src='img/square.jpg' width='15px'  height='15px'/></th><th><p>I additionally agree that videos during this study can be recorded and published.<p /></th></tr>"
                        if(data["record"]["audio"]) str += "<tr><th><img src='img/square.jpg' width='15px'  height='15px'/></th><th><p>I additionally agree that audio files during this study can be recorded and published.<p /></th></tr>"

                        str += "</table>I understand that data will be anonymized cannot be associated with my name. From the consent of publication, I do not derive any rights (such as any renumeration or co-authorship). This declaration of consent is revocable at any time in line with the GDPR. In the case of revocation, the published recordings, insofar as they are subject to the disposition of the researchers, will be removed. Further recordings are no longer used or published after revocation of publication.</p></tr>"
                        
                        str += "</table>"
                    }    
                }
                
                str += "<table>"
                str += "<tr><th><br /><br />__________________________________</th><th></th></tr>"
                str += "<tr><th>Printed Name of Subject</th><th></th></tr>"
                str += "<tr><th><br /><br />__________________________________</th><th><br /><br />_____________________________</th></tr>"
                str += "<tr><th>Signature of Subject</th><th>Location, Date</th></tr>"
                str += "</table>"
                str += "</div>";
            }
            
            $("#results").html("<div class='frameStyle'>"+str+"</div>");
            
            setTimeout(function () {
                //  window.print();  
            }, 100);
        }
         
    </script>
 </body>
</html>